import random

class Environment:
    def __init__(self):
        self.objects = []
        self.agents = []
        self.obstacles = []
        self.agent_locations = {}
        self.dirt_locations = set()  # Байршлыг шороогоор хянах
        self.obstacle_locations = set()  # Саад тотгор бүхий байршлыг хянах
        print("Environment is initialized")

    def default_location(self, obj):
        # Агент эсвэл объектын байршлыг санамсаргүй байдлаар эхлүүлэх
        return random.randint(0, 10)

    def percept(self, agent):
        # Агентын одоогийн байршлыг авах
        location = self.agent_locations[agent]

        # Агентын ойлголт: одоогийн байршлын нөхцөл дээр үндэслэсэн
        if location in self.dirt_locations:
            percept = 'Dirty'
        elif location in self.obstacle_locations:
            percept = 'Obstacle'
        else:
            percept = random.choice(['NoOp', 'Right', 'Left'])
        
        print(f"Agent at location {location} perceives: {percept}")
        return percept

    def execute_action(self, agent, action):
        # Үйлдэл дээр үндэслэн агентын байршил эсвэл орчныг шинэчил
        current_location = self.agent_locations[agent]

        if action == 'Suck':
            if current_location in self.dirt_locations:
                self.dirt_locations.remove(current_location)  # Байршлыг цэвэрлэ
                print(f"Agent cleans location {current_location}")
            else:
                print(f"No dirt to clean at location {current_location}")
        
        elif action == 'Right':
            new_location = current_location + 1
            if new_location in self.obstacle_locations:
                print(f"Agent cannot move right. Obstacle at location {new_location}")
            else:
                self.agent_locations[agent] = new_location
                print(f"Agent moves right to {new_location}")
        
        elif action == 'Left':
            new_location = current_location - 1
            if new_location in self.obstacle_locations:
                print(f"Agent cannot move left. Obstacle at location {new_location}")
            else:
                self.agent_locations[agent] = new_location
                print(f"Agent moves left to {new_location}")
        
        else:
            print("Agent does nothing")

    def exogenous_change(self):
        # Орчинд санамсаргүй байдлаар шороо оруулах
        if random.random() < 0.3:  # 30% chance to add dirt
            new_dirt_location = random.randint(0, 10)
            self.dirt_locations.add(new_dirt_location)
            print(f"Dirt appears at location {new_dirt_location}")

    def is_done(self):
        # Бүх агентууд дууссан эсвэл шороо байхгүй бол дуусга
        for agent in self.agents:
            if agent.is_alive():
                return False
        return True

    def step(self):
        # Агентуудыг ажиллуулж, экзоген өөрчлөлтийг хэрэгжүүлэх замаар хүрээлэн буй орчныг алхаарай
        actions = [agent.program(self.percept(agent)) for agent in self.agents]
        for agent, action in zip(self.agents, actions):
            self.execute_action(agent, action)
        self.exogenous_change()

    def run(self, steps=1000):
        # Орчноо тодорхой тооны алхамаар ажиллуул
        for step in range(steps):
            print(f"Step {step + 1}")
            self.step()

    def add_object(self, obj, location=None):
        # Орчинд агент эсвэл саад тотгор нэмнэ
        location = location or self.default_location(obj)
        
        if isinstance(obj, RandomAgent):
            self.agent_locations[obj] = location
            self.agents.append(obj)
            print(f"Agent added at location {location}")
        elif isinstance(obj, Obstacle):
            self.obstacle_locations.add(location)
            self.obstacles.append(obj)
            print(f"Obstacle added at location {location}")

class RandomAgent:
    def __init__(self):
        def program(percept):
            if percept == 'Dirty':
                action = 'Suck'
            elif percept == 'Obstacle':
                action = random.choice(['Right', 'Left'])
            elif percept == 'Right':
                action = 'Right'
            elif percept == 'Left':
                action = 'Left'
            else:
                action = 'NoOp'
            return action
        self.program = program
    
    def is_alive(self):
        # Агент үргэлж ажилж байна гэж бодъё
        return True

class Obstacle:
    pass

# Орчноо бүрдүүлнэ
environment = Environment()

# Агент үүсгэх
agent1 = RandomAgent()
agent2 = RandomAgent()

# Саад тотгор үүсгэ
obstacle1 = Obstacle()
obstacle2 = Obstacle()

# Байгаль орчинд агентууд болон саад тотгоруудыг нэмнэ
environment.add_object(agent1)
environment.add_object(agent2)
environment.add_object(obstacle1, location=3)  # Саадын байршлыг гараар тохируулах
environment.add_object(obstacle2, location=7)

# Орчноо хэдхэн алхамаар ажиллуул
environment.run(5)
